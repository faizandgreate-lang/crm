<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>MFK Riyadh Accommodation</title>
<style>
  body { font-family: "Poppins", Arial, sans-serif; margin: 20px; background:#fff; color:#000; }
  h1 { text-align:center; font-size:28px; margin-bottom:15px; }
  table{border-collapse:collapse;width:100%;margin:15px 0;background:#fff;border:1px solid #000;}
  th,td{border:1px solid #000;padding:8px 10px;text-align:left;font-size:14px;}
  th{background:#000;color:#fff;text-transform:uppercase;cursor:pointer;}
  tr:nth-child(even){background:#f0f0f0;}
  .form{border:1px solid #000;padding:12px;background:#fff;border-radius:8px;margin-top:10px;}
  .form input{margin:5px;padding:6px 10px;border:1px solid #000;border-radius:4px;}
  .form button{background:#000;color:#fff;border:none;padding:6px 10px;border-radius:4px;cursor:pointer;margin:5px;}
  .hidden{display:none;}
  .footer{text-align:center;margin-top:30px;color:#555;font-style:italic;}
  @media (max-width:768px){table,th,td{font-size:12px}.form input,button{width:100%;display:block;}}
  .summary-chart { display:flex; gap:20px; flex-wrap:wrap; align-items:flex-start; }
  .summary-chart > .box { flex:1; min-width:300px; background:transparent; }
  @keyframes breathe { 0%, 100% {transform: scale(1);} 50% {transform: scale(1.05);} }
  .breathing-logo { animation: breathe 2s ease-in-out infinite; height:90px; width:auto; }
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<!-- Loading Screen -->
<div id="loadingScreen" style="
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:#fff; display:flex; justify-content:center; align-items:center;
  z-index:9999; flex-direction:column;">
  <img src="https://i.ibb.co/7d19gQ0h/logo.png" class="breathing-logo" alt="Loading Logo" style="max-height:120px; margin-bottom:15px;">
  <p style="font-size:18px; font-weight:600;">Loading...</p>
</div>

<h1>MFK ACCOMMODATION</h1>

<!-- Logo with GitHub link -->
<div style="text-align:center; margin-bottom:20px;">
  <a href="https://github.com/faizandgreate-lang/CRM" target="_blank">
    <img src="https://i.ibb.co/7d19gQ0h/logo.png" 
         alt="MFK Logo" 
         class="breathing-logo" 
         style="max-height:100px; width:auto;">
  </a>
</div>

<!-- Top Control Bar -->
<div style="margin-bottom:15px; display:flex; justify-content:space-between; align-items:center;">
  <div>
    <span id="loginBox">
      <input type="text" id="loginUser" placeholder="User ID">
      <input type="password" id="loginPw" placeholder="Password">
      <button onclick="login()">Login</button>
    </span>
    <span id="adminBox" class="hidden">
      <button onclick="logout()">Logout</button>
    </span>
  </div>
</div>

<!-- Summary Charts -->
<div class="summary-chart" style="margin-top:12px;">
  <div id="clientChartBox" class="box">
    <h2>Worker Count Graph</h2>
    <canvas id="clientChart" height="300"></canvas>
  </div>
</div>

<!-- Worker Table -->
<h2>Worker Details</h2>
<div id="tableWrap"></div>

<div class="footer">Made with ❤️ by <span>Faizan Khan</span></div>

<script>
// Hide loading screen after page load
window.addEventListener("load", function() {
  document.getElementById("loadingScreen").style.display = "none";
  generateWorkerTable();
  startDynamicChart();
});

// Sample companies
const companies = ["I.R.C", "Rexus", "Galleria", "MFK Hospitality"];

// Generate 100 random workers
function generateWorkers() {
  let workers = [];
  for (let i = 1; i <= 100; i++) {
    workers.push({
      iq: "IQ" + String(1000+i),
      name: "Worker " + i,
      company: companies[Math.floor(Math.random()*companies.length)]
    });
  }
  return workers;
}

// Generate HTML table
function generateWorkerTable() {
  const workers = generateWorkers();
  let html = "<table><tr><th>IQAMA</th><th>Name</th><th>Company</th></tr>";
  workers.forEach(w => {
    html += `<tr><td>${w.iq}</td><td>${w.name}</td><td>${w.company}</td></tr>`;
  });
  html += "</table>";
  document.getElementById("tableWrap").innerHTML = html;
}

// Chart.js dynamic chart
let clientChart;
function startDynamicChart() {
  const ctx = document.getElementById("clientChart").getContext("2d");

  function updateChart() {
    const workers = generateWorkers();
    const summary = {};
    companies.forEach(c => summary[c] = 0);
    workers.forEach(w => summary[w.company]++);

    const data = {
      labels: Object.keys(summary),
      datasets: [{
        label: 'Number of Workers',
        data: Object.values(summary),
        backgroundColor: ['#000','#555','#999','#222'],
        borderColor: '#000',
        borderWidth: 1
      }]
    };

    if (clientChart) {
      clientChart.data.datasets[0].data = data.datasets[0].data;
      clientChart.update();
    } else {
      clientChart = new Chart(ctx, {
        type: 'bar',
        data: data,
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            title: { display: true, text: 'Workers per Company (Live)' }
          },
          scales: {
            y: { beginAtZero: true, ticks: { stepSize: 5 } }
          }
        }
      });
    }
  }

  updateChart();
  setInterval(updateChart, 3000); // update every 3 sec
}
</script>

</body>
</html>
